CREATE TABLE default.sharded_sessions (`session_id` String, `team_id` Int64, `distinct_id` SimpleAggregateFunction(any, String), `min_timestamp` SimpleAggregateFunction(min, DateTime64(6, 'UTC')), `max_timestamp` SimpleAggregateFunction(max, DateTime64(6, 'UTC')), `urls` SimpleAggregateFunction(groupUniqArrayArray, Array(String)), `entry_url` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `exit_url` AggregateFunction(argMax, String, DateTime64(6, 'UTC')), `initial_referring_domain` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_source` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_campaign` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_medium` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_term` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_content` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gad_source` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gclsrc` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_dclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gbraid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_wbraid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_fbclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_msclkid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_twclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_li_fat_id` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_mc_cid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_igshid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_ttclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_epik` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_qclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_sccid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `event_count_map` SimpleAggregateFunction(sumMap, Map(String, Int64)), `pageview_count` SimpleAggregateFunction(sum, Int64), `autocapture_count` SimpleAggregateFunction(sum, Int64)) ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/tables/{shard}/posthog.sessions', '{replica}') PARTITION BY toYYYYMM(min_timestamp) ORDER BY (toStartOfDay(min_timestamp), team_id, session_id) SETTINGS index_granularity = 512