CREATE TABLE default.sharded_raw_sessions (`team_id` Int64, `session_id_v7` UInt128, `distinct_id` AggregateFunction(argMax, String, DateTime64(6, 'UTC')), `min_timestamp` SimpleAggregateFunction(min, DateTime64(6, 'UTC')), `max_timestamp` SimpleAggregateFunction(max, DateTime64(6, 'UTC')), `max_inserted_at` SimpleAggregateFunction(max, DateTime64(6, 'UTC')), `urls` SimpleAggregateFunction(groupUniqArrayArray, Array(String)), `entry_url` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `end_url` AggregateFunction(argMax, String, DateTime64(6, 'UTC')), `last_external_click_url` AggregateFunction(argMax, String, DateTime64(6, 'UTC')), `initial_browser` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_browser_version` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_os` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_os_version` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_device_type` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_viewport_width` AggregateFunction(argMin, Int64, DateTime64(6, 'UTC')), `initial_viewport_height` AggregateFunction(argMin, Int64, DateTime64(6, 'UTC')), `initial_geoip_country_code` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_geoip_subdivision_1_code` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_geoip_subdivision_1_name` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_geoip_subdivision_city_name` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_geoip_time_zone` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_referring_domain` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_source` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_campaign` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_medium` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_term` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_utm_content` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gad_source` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gclsrc` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_dclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_gbraid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_wbraid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_fbclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_msclkid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_twclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_li_fat_id` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_mc_cid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_igshid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_ttclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_epik` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_qclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_sccid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial__kx` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `initial_irclid` AggregateFunction(argMin, String, DateTime64(6, 'UTC')), `pageview_count` SimpleAggregateFunction(sum, Int64), `pageview_uniq` AggregateFunction(uniq, Nullable(UUID)), `autocapture_count` SimpleAggregateFunction(sum, Int64), `autocapture_uniq` AggregateFunction(uniq, Nullable(UUID)), `screen_count` SimpleAggregateFunction(sum, Int64), `screen_uniq` AggregateFunction(uniq, Nullable(UUID)), `maybe_has_session_replay` SimpleAggregateFunction(max, Bool), `page_screen_autocapture_uniq_up_to` AggregateFunction(uniqUpTo(1), Nullable(UUID)), `vitals_lcp` AggregateFunction(argMin, Nullable(Float64), DateTime64(6, 'UTC'))) ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/tables/{shard}/posthog.raw_sessions', '{replica}') PARTITION BY toYYYYMM(fromUnixTimestamp(intDiv(toUInt64(bitShiftRight(session_id_v7, 80)), 1000))) ORDER BY (team_id, toStartOfHour(fromUnixTimestamp(intDiv(toUInt64(bitShiftRight(session_id_v7, 80)), 1000))), cityHash64(session_id_v7), session_id_v7) SAMPLE BY cityHash64(session_id_v7) SETTINGS index_granularity = 8192