CREATE TABLE default.sharded_app_metrics (`team_id` Int64, `timestamp` DateTime64(6, 'UTC'), `plugin_config_id` Int64, `category` LowCardinality(String), `job_id` String, `successes` SimpleAggregateFunction(sum, Int64), `successes_on_retry` SimpleAggregateFunction(sum, Int64), `failures` SimpleAggregateFunction(sum, Int64), `error_uuid` UUID, `error_type` String, `error_details` String CODEC(ZSTD(3)), `_timestamp` DateTime, `_offset` UInt64, `_partition` UInt64) ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/tables/{shard}/posthog.sharded_app_metrics', '{replica}') PARTITION BY toYYYYMM(timestamp) ORDER BY (team_id, plugin_config_id, job_id, category, toStartOfHour(timestamp), error_type, error_uuid) SETTINGS index_granularity = 8192