CREATE VIEW default.custom_metrics_events_recent_lag (`name` String, `labels` Map(String, String), `value` Int64, `help` String, `type` String) AS SELECT 'ClickHouseCustomMetric_EventsRecentIngestionLag' AS name, map('instance', hostname()) AS labels, dateDiff('second', max(timestamp), now()) AS value, 'The number of seconds that have passed since the most recent event was inserted into events_recent table' AS help, 'gauge' AS type FROM default.events_recent WHERE (team_id IN []) AND (event IN ('$heartbeat')) AND (timestamp < (now() + toIntervalMinute(3))) AND (inserted_at > (now() - toIntervalHour(3))) GROUP BY event