CREATE TABLE default.query_log_archive (`hostname` LowCardinality(String), `user` LowCardinality(String), `query_id` String, `type` Enum8('QueryStart' = 1, 'QueryFinish' = 2, 'ExceptionBeforeStart' = 3, 'ExceptionWhileProcessing' = 4), `event_date` Date, `event_time` DateTime, `event_time_microseconds` DateTime64(6), `query_start_time` DateTime, `query_start_time_microseconds` DateTime64(6), `query_duration_ms` UInt64, `read_rows` UInt64, `read_bytes` UInt64, `written_rows` UInt64, `written_bytes` UInt64, `result_rows` UInt64, `result_bytes` UInt64, `memory_usage` UInt64, `peak_threads_usage` UInt64, `current_database` LowCardinality(String), `query` String, `formatted_query` String, `normalized_query_hash` UInt64, `query_kind` LowCardinality(String), `exception_code` Int32, `exception` String, `stack_trace` String, `ProfileEvents_RealTimeMicroseconds` Int64, `ProfileEvents_OSCPUVirtualTimeMicroseconds` Int64, `ProfileEvents_S3Clients` Int64, `ProfileEvents_S3DeleteObjects` Int64, `ProfileEvents_S3CopyObject` Int64, `ProfileEvents_S3ListObjects` Int64, `ProfileEvents_S3HeadObject` Int64, `ProfileEvents_S3GetObjectAttributes` Int64, `ProfileEvents_S3CreateMultipartUpload` Int64, `ProfileEvents_S3UploadPartCopy` Int64, `ProfileEvents_S3UploadPart` Int64, `ProfileEvents_S3AbortMultipartUpload` Int64, `ProfileEvents_S3CompleteMultipartUpload` Int64, `ProfileEvents_S3PutObject` Int64, `ProfileEvents_S3GetObject` Int64, `ProfileEvents_ReadBufferFromS3Bytes` Int64, `ProfileEvents_WriteBufferFromS3Bytes` Int64, `lc_workflow` LowCardinality(String), `lc_kind` LowCardinality(String), `lc_id` String, `lc_route_id` String, `lc_access_method` LowCardinality(String), `lc_api_key_label` String, `lc_api_key_mask` String, `lc_query_type` LowCardinality(String), `lc_product` LowCardinality(String), `lc_chargeable` Bool, `lc_name` String, `lc_request_name` String, `lc_client_query_id` String, `lc_org_id` String, `team_id` Int64, `lc_user_id` Int64, `lc_session_id` String, `lc_dashboard_id` Int64, `lc_insight_id` Int64, `lc_cohort_id` Int64, `lc_batch_export_id` String, `lc_experiment_id` Int64, `lc_experiment_feature_flag_key` String, `lc_alert_config_id` String, `lc_feature` LowCardinality(String), `lc_table_id` String, `lc_warehouse_query` Bool, `lc_person_on_events_mode` LowCardinality(String), `lc_service_name` String, `lc_workload` LowCardinality(String), `lc_query__kind` LowCardinality(String), `lc_query__query` String, `lc_temporal__workflow_namespace` String, `lc_temporal__workflow_type` String, `lc_temporal__workflow_id` String, `lc_temporal__workflow_run_id` String, `lc_temporal__activity_type` String, `lc_temporal__activity_id` String, `lc_temporal__attempt` Int64, `lc_dagster__job_name` String, `lc_dagster__run_id` String, `lc_dagster__owner` String) ENGINE = ReplicatedMergeTree('/clickhouse/tables/noshard/posthog.query_log_archive_new', '{replica}-{shard}') PARTITION BY toYYYYMM(event_date) PRIMARY KEY (team_id, event_date, event_time, query_id) ORDER BY (team_id, event_date, event_time, query_id) SETTINGS index_granularity = 8192